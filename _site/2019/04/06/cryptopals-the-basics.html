<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Cryptopals - The basics | patrickrbc</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Cryptopals - The basics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="If you have any kind of interest in crypto you should probably check this out. Recently, I started doing the Cryptopals which are a series of cryptography challenges created by the formerly Matasano Security team. They are a collection of 48 exercises divided in 8 sets. I have just finished the first set but I can guarantee you that it is a lot of fun and learning." />
<meta property="og:description" content="If you have any kind of interest in crypto you should probably check this out. Recently, I started doing the Cryptopals which are a series of cryptography challenges created by the formerly Matasano Security team. They are a collection of 48 exercises divided in 8 sets. I have just finished the first set but I can guarantee you that it is a lot of fun and learning." />
<link rel="canonical" href="http://localhost:4000/2019/04/06/cryptopals-the-basics" />
<meta property="og:url" content="http://localhost:4000/2019/04/06/cryptopals-the-basics" />
<meta property="og:site_name" content="patrickrbc" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-06T16:42:00-03:00" />
<script type="application/ld+json">
{"url":"http://localhost:4000/2019/04/06/cryptopals-the-basics","headline":"Cryptopals - The basics","dateModified":"2019-04-06T16:42:00-03:00","datePublished":"2019-04-06T16:42:00-03:00","description":"If you have any kind of interest in crypto you should probably check this out. Recently, I started doing the Cryptopals which are a series of cryptography challenges created by the formerly Matasano Security team. They are a collection of 48 exercises divided in 8 sets. I have just finished the first set but I can guarantee you that it is a lot of fun and learning.","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/04/06/cryptopals-the-basics"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="patrickrbc" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">patrickrbc</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Cryptopals - The basics</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-04-06T16:42:00-03:00" itemprop="datePublished">Apr 6, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>If you have <strong>any</strong> kind of interest in crypto you should probably check this
out.  Recently, I started doing the <strong>Cryptopals</strong> which are a series of
cryptography challenges created by the formerly Matasano Security team. They
are a collection of 48 exercises divided in 8 sets. I have just finished the
first set but I can guarantee you that it is a lot of fun and learning.</p>

<p><strong>SPOILER ALERT</strong>: This is post will give the solutions for the first set of
exercises, if you are planning to do it, stop reading this now and try them by
yourself. However, if you are still unsure if this is for you or not, maybe try
skim reading through this post to see if you get the taste for it.</p>

<p>Resolving the first set was mix of love and hate feelings. Sometimes I was able
to get the idea but ended up making a programming mistake that would keep me
stuck for while in one challenge or another. They stated in their website that
this is a “relatively easy” challenge with the except of one. I can’t tell you
about the further sets but one challenge in this set took me 2 days to get it
right.</p>

<p>I decided to write my solutions in Node.js and this was a good way to learn
about some quirks of the language that I did not face in a common daily
programming session. You might also want to choose a new programming language
to kill two birds with one stone.</p>

<h1 id="challenge-1-convert-hex-to-base64">Challenge 1: Convert hex to base64</h1>

<p>There is no mystery in here. If you were dealing with client-side JavaScript
you would be looking for atob and btoa, but in Node.js you will want to be
familiar with the Buffer API. Needless to 
say, you shouldn’t include any third-party libraries to solve the challenges.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Buffer</span>
<span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="s1">'49276d206b696c6c696e6720796f757220627261696e206c696b65206120706f69736f6e6f7573206d757368726f6f6d'</span><span class="p">,</span><span class="s1">'hex'</span><span class="p">)</span>
<span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">'base64'</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<h1 id="challenge-2-fixed-xor">Challenge 2: Fixed XOR</h1>

<p>This challenge will introduce you to XOR operation for cryptographic purposes.
The <strong>simple XOR cipher</strong> is a type of additive cipher that was used in the
past to encrypt text, but it is clearly not safe since the ciphertext could be
decrypted using frequency analysis. On the other hand, the XOR operation is
still frequently used in more complex ciphers, due to its simplicity and
performance.</p>

<p>The challenges asks for a function that takes two equal-length buffers and
produces their XOR combination. A solution for this exercise would be to loop
through one of the buffers doing a XOR with each correspondent byte from the
other buffer. The code that can do this will be shown further in this post.</p>

<p><br /></p>

<h1 id="challenge-3-single-byte-xor-cipher">Challenge 3: Single-byte XOR cipher</h1>

<p>Now that we already know how to cipher and decipher messages using XOR, things are going
to start becoming interesting. The challenge presents an hex encoded string
that was XOR’d against a single character and asks us to discover this key and
decrypt the message.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
  This will receive a message and XOR every character in it with a byte which
  is our key. We will try all possible characters with ASCII code from 0 to 256
  (this range was arbitrary).
*/</span>
<span class="kd">function</span> <span class="nx">breakSingleByte</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">plainText</span><span class="p">,</span> <span class="nx">tempBuffer</span>
  <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">keyChar</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span> <span class="nx">keyChar</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">keyChar</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">tempBuffer</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">(</span>
      <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="s1">'hex'</span><span class="p">),</span>
      <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">keyChar</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="nx">plainText</span> <span class="o">=</span> <span class="nx">tempBuffer</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>

<span class="cm">/*
  If the resultant string has only printable characters, it will have its
  character frequency computed and it will be added to the results array
*/</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/</span><span class="se">[^\x</span><span class="sr">00-</span><span class="se">\x</span><span class="sr">7E</span><span class="se">]</span><span class="sr">/g</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">plainText</span><span class="p">))</span>
      <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">key</span><span class="p">:</span> <span class="nx">keyChar</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="nx">plainText</span><span class="p">,</span>
        <span class="na">score</span><span class="p">:</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">Util</span><span class="p">.</span><span class="nx">calculateFrequency</span><span class="p">(</span><span class="nx">plainText</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
      <span class="p">})</span>
  <span class="p">}</span>

  <span class="c1">// The string with the best score in the results array will be returned </span>
  <span class="k">return</span> <span class="nx">results</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">score</span> <span class="o">&lt;</span> <span class="nx">y</span><span class="p">.</span><span class="nx">score</span><span class="p">)</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nx">shift</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If everything works fine, we will get the decrypted message:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Cooking MC\'s like a pound of bacon
</code></pre></div></div>

<p><br /></p>

<h1 id="challenge-4-detect-single-character-xor">Challenge 4: Detect single-character XOR</h1>

<p>This time we were given a file containing a lot of encrypted strings. The Goal
was to find it, but we know from the previous exercise that decrypting it would
be really easy too.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">strings</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readfilesync</span><span class="p">(</span><span class="s1">'../res/4.txt'</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">'</span><span class="err">\</span><span class="s1">n'</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">decrypted</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">result</span>

<span class="nx">strings</span><span class="p">.</span><span class="nx">foreach</span><span class="p">((</span><span class="nx">string</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">result</span> <span class="o">=</span> <span class="nx">xor</span><span class="p">.</span><span class="nx">breaksinglebyte</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">string</span> <span class="o">=</span> <span class="nx">string</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">line</span>   <span class="o">=</span> <span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nx">decrypted</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>If everything works fine, we will get the decrypted message:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Now that the party is jumping\n
</code></pre></div></div>

<p><br /></p>

<h1 id="challenge-5-implement-repeating-key-xor">Challenge 5: Implement repeating-key XOR</h1>

<p>This challenge is similar to the second one, but this time the message length
is bigger than the key length and we will use the <a href="https://en.wikipedia.org/wiki/Vigenère_cipher">Vigenère
cipher</a>. In this case, the key
to be repeated to cipher the whole message. Maybe this challenge could be
placed after the second one.</p>

<p>In order to reuse code some of the functions used in these challenges were
created in a separated file. Since XOR is a commonly used operation, I decided
to create a function that will XOR two buffers repeating the smallest one which
would be the key.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">cipher</span> <span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
    <span class="p">[</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">key</span><span class="p">,</span> <span class="nx">msg</span><span class="p">]</span>

  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">alloc</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">,</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
    <span class="nx">result</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">^</span> <span class="nx">key</span><span class="p">[</span><span class="nx">j</span> <span class="o">%</span> <span class="nx">key</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>

  <span class="k">return</span> <span class="nx">result</span>
<span class="p">}</span>
</code></pre></div></div>

<p><br /></p>

<h1 id="challenge-6-break-repeating-key-xor">Challenge 6: Break repeating-key XOR</h1>

<p><em>“It is officially on, now.”</em>
This one took me a while to make it work right. They give you a file containing
a message that is encrypted with repeating-xor and encoded in base64. This
where you put together everything you learned until now. Fortunately, they give
you the steps to do it.</p>

<p>The first thing you need to do is to figure out the size of the key. Unless you
have a crystal ball at home, you can start guessing. They suggest values from 2
to 40.</p>

<h4 id="the-hamming-distance">The hamming distance</h4>

<p>todo</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div></div>

<p>Now, using each of the guessed key sizes do the following steps:</p>

<ol>
  <li>Divide the message in KEYSIZE worth of bytes</li>
  <li>Calculate the hamming distance between them and normalize dividing by the
   KEYSIZE</li>
  <li>Find the KEYSIZE with smallest normalized hamming distance</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div></div>

<p>Once you have the KEYSIZE, you can use the following strategy to discover the
key:</p>

<ol>
  <li>Break the ciphertext into blocks of KEYSIZE length</li>
  <li>Transpose the blocks: make a block that is the first byte of every block,
and a block that is the second byte of every block, and so on.</li>
  <li>Solve each block as it was single-character XOR</li>
  <li>For each block, the single-byte XOR key that produces the best output is
the XOR key byte for that block.</li>
  <li>Put them together and you have the key</li>
</ol>

<p>Using this key against the file will give you the lyrics of <a href="">this song</a>.</p>

<p><br /></p>

<h1 id="challenge-7-aes-in-ecb-mode">Challenge 7: AES in ECB mode</h1>

<p>After solving the previous challenge the last two are pretty seemed like a walk
in a park. This is an introduction to the block cipher AES.</p>

<p>A block cipher is…
https://en.wikipedia.org/wiki/Block_cipher#Rijndael_</p>

<p>Examples: DES, RC5, Blowfish, AES</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">decrypt</span> <span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">decipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createDecipheriv</span><span class="p">(</span><span class="s1">'aes-128-ecb'</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="s1">'base64'</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">)</span>
  <span class="nx">out</span> <span class="o">+=</span> <span class="nx">decipher</span><span class="p">.</span><span class="kr">final</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>

  <span class="k">return</span> <span class="nx">out</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If everything works fine, we will get the same lyrics of the previous
challenge.</p>

<p><br /></p>

<h1 id="challenge-8-detect-aes-in-ecb-mode">Challenge 8: Detect AES in ECB mode</h1>

<p>This challenges requires you to find which one of the ciphertexts in a file was
encrytpted with AES in ECB mode. The ECB mode is…</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ciphertexts</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">ciphertext</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">cipherTextBlocks</span> <span class="o">=</span> <span class="nx">divideInBlocks</span><span class="p">(</span><span class="nx">ciphertext</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

  <span class="nx">cipherTextBlocks</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">block</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="na">line</span><span class="p">:</span> <span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">ciphertext</span><span class="p">:</span> <span class="nx">ciphertext</span><span class="p">,</span>
      <span class="na">repetitions</span><span class="p">:</span> <span class="nx">countRepetitions</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span> <span class="nx">cipherTextBlocks</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>

<p><br /></p>

<h1 id="what-we-have-learned">What we have learned?</h1>

<p>-
 -
 -</p>

<h1 id="conclusion">Conclusion</h1>

<p>I am planning on doing the other sets soon and I will probably release the
solutions on Github and make my comments about them here. Stay tuned!</p>

<p><br /></p>

<h1 id="references">References</h1>

<ul>
  <li><a href="https://uwaterloo.ca/combinatorics-and-optimization/sites/ca.combinatorics-and-optimization/files/uploads/files/corr98-39.pdf">Tutte, William T. “Fish and I.”</a></li>
</ul>


  </div>
<a class="u-url" href="/2019/04/06/cryptopals-the-basics" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">patrickrbc</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name"></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/patrickrbc"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">patrickrbc</span></a></li><li><a href="https://www.twitter.com/patrickrbc"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">patrickrbc</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Olá! My name is Patrick and I am a software and security engineer based in Recife, Brazil. Welcome to my blog!</p>
      </div>
    </div>

  </div>

</footer>
<script async
      src="https://www.googletagmanager.com/gtag/js?id=UA-137241651-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-137241651-1');
    </script>
  </body>

</html>
